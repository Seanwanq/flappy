# ğŸ¦ Flappy å…¨é‡ä½¿ç”¨æ‰‹å†Œ (v0.0.1)

Flappy æ—¨åœ¨ä¸º C++ æä¾›â€œå¼€ç®±å³ç”¨â€çš„æ„å»ºä½“éªŒã€‚æœ¬æ‰‹å†Œæ¶µç›–äº† Flappy çš„æ‰€æœ‰åŠŸèƒ½ã€é…ç½®é¡¹åŠé«˜çº§ç”¨æ³•ã€‚

---

## ğŸ›  é…ç½®æ–‡ä»¶: `flappy.toml`

è¿™æ˜¯é¡¹ç›®çš„æ ¸å¿ƒã€‚å®ƒç”±å››ä¸ªä¸»è¦éƒ¨åˆ†ç»„æˆï¼š`[package]`, `[build]`, `[test]`, å’Œ `[dependencies]`ã€‚

### 1. é¡¹ç›®å…ƒæ•°æ® `[package]`
| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
| :--- | :--- | :--- |
| `name` | é¡¹ç›®åç§°ï¼ˆå½±å“é»˜è®¤è¾“å‡ºæ–‡ä»¶åï¼‰ | `"my_project"` |
| `version` | é¡¹ç›®ç‰ˆæœ¬ | `"0.1.0"` |
| `authors` | ä½œè€…åˆ—è¡¨ (æ•°ç»„) | `["Name <email@example.com>"]` |

---

### 2. æ„å»ºé…ç½® `[build]`
è¿™æ˜¯ Flappy æœ€å¼ºå¤§çš„åœ°æ–¹ï¼Œæ”¯æŒå¤šå±‚çº§è¦†ç›–ã€‚

#### æ ¸å¿ƒå­—æ®µï¼š
*   **`language`**: `"c"` æˆ– `"c++"`ã€‚
*   **`standard`**: è¯­è¨€æ ‡å‡†ï¼Œå¦‚ `"c++17"`, `"c++20"`, `"c11"`ã€‚
*   **`type`**: è¾“å‡ºç±»å‹ï¼š`"exe"`, `"lib"` (é™æ€åº“), `"dll"` (åŠ¨æ€åº“)ã€‚
*   **`output`**: è¾“å‡ºè·¯å¾„åŠæ–‡ä»¶åï¼Œå¦‚ `"bin/app"`ã€‚
*   **`compiler`**: ç¼–è¯‘å™¨å‘½ä»¤ï¼Œå¦‚ `"cl"`, `"g++"`, `"clang++"`ã€‚
*   **`arch`**: ç›®æ ‡æ¶æ„ï¼š`"x64"`, `"x86"`, `"arm64"`ã€‚
*   **`defines`**: å®å®šä¹‰æ•°ç»„ï¼Œå¦‚ `["DEBUG", "VERSION=1"]`ã€‚
*   **`flags`**: ç¼–è¯‘å™¨åŸç”Ÿæ ‡å¿—æ•°ç»„ï¼Œå¦‚ `["/W4", "-O3"]`ã€‚

#### å±‚çº§è¦†ç›– (Inheritance)ï¼š
ä½ å¯ä»¥é€šè¿‡åç¼€æ¥é’ˆå¯¹ç‰¹å®šç¯å¢ƒè¿›è¡Œç»†åˆ†é…ç½®ã€‚åˆå¹¶ä¼˜å…ˆçº§å¦‚ä¸‹ï¼ˆé«˜ä¼˜å…ˆçº§è¦†ç›–ä½ä¼˜å…ˆçº§ï¼‰ï¼š

1.  `[build]` (åŸºç¡€é…ç½®)
2.  `[build.debug]` æˆ– `[build.release]` (æ¨¡å¼è¦†ç›–)
3.  `[build.windows]` / `[build.linux]` / `[build.macos]` (å¹³å°è¦†ç›–)
4.  `[build.windows.debug]` (å¹³å° + æ¨¡å¼ç»„åˆè¦†ç›–)
5.  `[build.target_name]` (è‡ªå®šä¹‰ Profile è¦†ç›–ï¼Œè¯¦è§ä¸‹æ–‡)

**ç¤ºä¾‹ï¼š**
```toml
[build]
standard = "c++20"
defines = ["GLOBAL"]

[build.debug]
defines = ["DEBUG_ONLY"] # ä»…åœ¨ debug æ¨¡å¼ç”Ÿæ•ˆ

[build.windows]
compiler = "cl" # Windows é»˜è®¤ç”¨ cl

[build.windows.release]
flags = ["/O2"] # ä»…åœ¨ Windows çš„ Release æ¨¡å¼ç”Ÿæ•ˆ
```

---

### 3. ä¾èµ–ç®¡ç† `[dependencies]`
æ”¯æŒ Git, URL, æœ¬åœ°è·¯å¾„ï¼Œå¹¶èƒ½å¤„ç†é Flappy é¡¹ç›®ã€‚

#### å®šä¹‰ä¾èµ–ï¼š
```toml
[dependencies.fmt]
git = "https://github.com/fmtlib/fmt.git"
tag = "10.2.1"

[dependencies.stb]
url = "https://example.com/stb_image.h"

[dependencies.mylib]
path = "../mylib"
```

#### ä¾èµ–é«˜çº§å­—æ®µï¼š
*   **`build_cmd`**: è‡ªå®šä¹‰æ„å»ºå‘½ä»¤ã€‚å¦‚æœå­˜åœ¨ï¼ŒFlappy å°†è°ƒç”¨å®ƒè€Œä¸æ˜¯è‡ªåŠ¨ç¼–è¯‘ã€‚
*   **`dependencies`**: **(æ¡¥æ¥)** æ‰‹åŠ¨æŒ‡å®šæ­¤ä¾èµ–é¡¹è¿˜ä¾èµ–äºå“ªäº›å…¶ä»–ä¾èµ–é¡¹ï¼ˆç”¨äºé Flappy é¡¹ç›®ï¼‰ã€‚
*   **`include_dirs`**: æ‰‹åŠ¨æŒ‡å®šå¤´æ–‡ä»¶ç›®å½•ï¼Œå¦‚ `["include", "src/public"]`ã€‚
*   **`lib_dirs`**: æ‰‹åŠ¨æŒ‡å®šåº“æ–‡ä»¶æœç´¢ç›®å½•ã€‚
*   **`libs`**: æ‰‹åŠ¨æŒ‡å®šè¦é“¾æ¥çš„åº“æ–‡ä»¶åï¼Œå¦‚ `["zlib.lib"]`ã€‚
*   **`defines`**: ä¼ é€’ç»™è¯¥ä¾èµ–é¡¹åŠå…¶ä½¿ç”¨è€…çš„å®ã€‚

#### ä¾èµ–çš„å¹³å°/æ¨¡å¼è¦†ç›–ï¼š
åŒæ ·æ”¯æŒ `[dependencies.pkg.windows]`, `[dependencies.pkg.debug]` ç­‰ã€‚

**ç»ˆæç¤ºä¾‹ï¼š**
```toml
[dependencies.openssl]
git = "..."
[dependencies.openssl.windows.debug]
build_cmd = "nmake -f Makefile.msvc"
libs = ["libssld.lib"]

[dependencies.libcurl]
git = "..."
dependencies = ["openssl"] # å£°æ˜ libcurl ä¾èµ– openssl
```

---

## ğŸš€ ç¯å¢ƒå˜é‡æ³¨å…¥ (Environment Injection)

å½“ Flappy è¿è¡Œ `build_cmd` æ—¶ï¼Œä¼šè‡ªåŠ¨æ³¨å…¥ä»¥ä¸‹å˜é‡ï¼Œä¾›ä½ çš„è„šæœ¬ä½¿ç”¨ï¼š

| å˜é‡å | è¯´æ˜ |
| :--- | :--- |
| `CC` / `CXX` | å½“å‰é…ç½®çš„ç¼–è¯‘å™¨è·¯å¾„ |
| `FLAPPY_DEP_<NAME>_INCLUDE` | ä¾èµ–é¡¹ `<NAME>` çš„å¤´æ–‡ä»¶ç›®å½•è·¯å¾„ |
| `FLAPPY_DEP_<NAME>_LIB` | ä¾èµ–é¡¹ `<NAME>` çš„åº“æ–‡ä»¶è·¯å¾„ |
| `INCLUDE` / `LIB` | (MSVC) è‡ªåŠ¨è¿½åŠ äº†ä¾èµ–é¡¹è·¯å¾„çš„ç³»ç»Ÿå˜é‡ |
| `CPATH` / `LIBRARY_PATH` | (GCC/Clang) è‡ªåŠ¨è¿½åŠ äº†ä¾èµ–é¡¹è·¯å¾„çš„ç³»ç»Ÿå˜é‡ |

*æ³¨ï¼š`<NAME>` ä¼šè¢«è½¬æ¢ä¸ºå¤§å†™ä¸”å°† `-` æ›¿æ¢ä¸º `_`ã€‚*

---

## ğŸ’» å‘½ä»¤è¡Œå‚è€ƒ (CLI)

### åŸºç¡€å‘½ä»¤
*   **`flappy init [name]`**: åœ¨å½“å‰ç›®å½•æˆ–æ–°ç›®å½•åˆå§‹åŒ–é¡¹ç›®ã€‚
*   **`flappy build [profile]`**: æ‰§è¡Œæ„å»ºã€‚
    *   `--release`: åˆ‡æ¢åˆ° Release æ¨¡å¼ã€‚
    *   `--no-deps`: ä»…ç¼–è¯‘å½“å‰é¡¹ç›®ï¼Œè·³è¿‡ä¾èµ–æ£€æŸ¥ï¼ˆç”¨äºå­è¿›ç¨‹åŠ é€Ÿï¼‰ã€‚
    *   `-t, --target <name>`: ä½¿ç”¨ `[build.<name>]` å®šä¹‰çš„ç‰¹å®šé…ç½®ã€‚
*   **`flappy run [profile] [-- <args>]`**: æ„å»ºå¹¶è¿è¡Œã€‚`--` ä¹‹åçš„å‚æ•°å°†ä¼ é€’ç»™ç¨‹åºã€‚
*   **`flappy test [profile]`**: æ„å»ºå¹¶è¿è¡Œ `[test]` èŠ‚å®šä¹‰çš„æµ‹è¯•ã€‚
*   **`flappy sync`**: è§£æä¾èµ–å›¾ï¼Œä¸‹è½½å¹¶æ„å»ºæ‰€æœ‰ä¾èµ–ï¼Œæ›´æ–° `flappy.lock`ã€‚
*   **`flappy clean`**: æ¸…ç†æ„å»ºäº§ç‰© (`bin/`, `obj/`, `dist/`)ã€‚

### è¾…åŠ©å‘½ä»¤
*   **`flappy compdb [profile]`**: å¼ºåˆ¶ç”Ÿæˆ `compile_commands.json`ã€‚
*   **`flappy profile add`**: äº¤äº’å¼æ·»åŠ è‡ªå®šä¹‰æ„å»º Profileã€‚
*   **`flappy xplat`**: äº¤äº’å¼é…ç½®è·¨å¹³å°å·¥å…·é“¾ã€‚
*   **`flappy cache clean`**: æ¸…ç†å…¨å±€ä¾èµ–ç¼“å­˜ã€‚

---

## ğŸ”„ æ„å»ºç”Ÿå‘½å‘¨æœŸ

1.  **Resolution**: è§£æ `flappy.toml`ï¼Œæ„å»ºå…¨å±€ä¾èµ–å›¾ (DAG)ï¼Œæ£€æµ‹å¾ªç¯å’Œç‰ˆæœ¬å†²çªã€‚
2.  **Fetching**: ä¸‹è½½æ‰€æœ‰ç¼ºå¤±çš„ä¾èµ–æºç ã€‚
3.  **Dependency Build**: æŒ‰ç…§æ‹“æ‰‘é¡ºåºï¼ˆä»å¶å­åˆ°æ ¹ï¼‰æ„å»ºä¾èµ–ã€‚
    *   å¦‚æœæ˜¯ Flappy é¡¹ç›®ï¼Œé€’å½’è°ƒç”¨ `flappy build --no-deps`ã€‚
    *   å¦‚æœæ˜¯ Raw é¡¹ç›®ï¼Œè°ƒç”¨ `build_cmd`ã€‚
4.  **Main Build**: ç¼–è¯‘å½“å‰é¡¹ç›®æºç ï¼Œå¹¶é“¾æ¥æ‰€æœ‰ä¾èµ–äº§ç‰©ã€‚
5.  **Distribution**: å°†åº“æ–‡ä»¶å’Œå¤´æ–‡ä»¶æ”¶é›†åˆ° `dist/` ç›®å½•ï¼Œç”Ÿæˆ `CMake` é…ç½®æ–‡ä»¶ã€‚